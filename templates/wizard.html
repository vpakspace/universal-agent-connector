{% extends "base.html" %}

{% block title %}Integration Wizard - AI Agent Connector{% endblock %}

{% block content %}
<div class="wizard">
    <h2>Connect Agent & Database</h2>
    <p class="subtitle">Follow these simple steps to connect your AI agent to a database</p>
    
    <div class="wizard-steps">
        <div class="step-indicator">
            <div class="step active" data-step="1">
                <span class="step-number">1</span>
                <span class="step-label">Agent Info</span>
            </div>
            <div class="step" data-step="2">
                <span class="step-number">2</span>
                <span class="step-label">Database</span>
            </div>
            <div class="step" data-step="3">
                <span class="step-number">3</span>
                <span class="step-label">Credentials</span>
            </div>
            <div class="step" data-step="4">
                <span class="step-number">4</span>
                <span class="step-label">Review</span>
            </div>
        </div>
        
        <form id="wizard-form" class="wizard-form">
            <!-- Step 1: Agent Information -->
            <div class="wizard-step active" id="step-1">
                <h3>Agent Information</h3>
                <div class="form-group">
                    <label for="agent-id">Agent ID *</label>
                    <input type="text" id="agent-id" name="agent_id" required 
                           placeholder="e.g., my-reporting-agent">
                    <small>Unique identifier for your agent</small>
                </div>
                <div class="form-group">
                    <label for="agent-name">Agent Name</label>
                    <input type="text" id="agent-name" name="agent_name" 
                           placeholder="e.g., Reporting Agent">
                </div>
                <div class="form-group">
                    <label for="agent-type">Agent Type</label>
                    <select id="agent-type" name="agent_type">
                        <option value="assistant">Assistant</option>
                        <option value="analytics">Analytics</option>
                        <option value="reporting">Reporting</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-primary" onclick="nextStep()">Next: Database</button>
                </div>
            </div>
            
            <!-- Step 2: Database Connection -->
            <div class="wizard-step" id="step-2">
                <h3>Database Connection</h3>
                <div class="form-group">
                    <label>
                        <input type="radio" name="db-connection-type" value="string" checked 
                               onchange="toggleConnectionType()">
                        Connection String
                    </label>
                    <label>
                        <input type="radio" name="db-connection-type" value="params" 
                               onchange="toggleConnectionType()">
                        Individual Parameters
                    </label>
                </div>
                
                <div id="connection-string-group">
                    <div class="form-group">
                        <label for="connection-string">Connection String *</label>
                        <input type="text" id="connection-string" name="connection_string" 
                               placeholder="postgresql://user:password@host:port/database">
                        <small>Full PostgreSQL connection string</small>
                    </div>
                </div>
                
                <div id="connection-params-group" style="display: none;">
                    <div class="form-group">
                        <label for="db-host">Host *</label>
                        <input type="text" id="db-host" name="host" placeholder="localhost">
                    </div>
                    <div class="form-group">
                        <label for="db-port">Port</label>
                        <input type="number" id="db-port" name="port" value="5432" placeholder="5432">
                    </div>
                    <div class="form-group">
                        <label for="db-user">Username *</label>
                        <input type="text" id="db-user" name="user" placeholder="postgres">
                    </div>
                    <div class="form-group">
                        <label for="db-password">Password *</label>
                        <input type="password" id="db-password" name="password" placeholder="••••••••">
                    </div>
                    <div class="form-group">
                        <label for="db-database">Database Name *</label>
                        <input type="text" id="db-database" name="database" placeholder="mydb">
                    </div>
                </div>
                
                <div class="form-group">
                    <button type="button" class="btn btn-secondary" onclick="testConnection()">
                        Test Connection
                    </button>
                    <span id="connection-status"></span>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="prevStep()">Back</button>
                    <button type="button" class="btn btn-primary" onclick="nextStep()">Next: Credentials</button>
                </div>
            </div>
            
            <!-- Step 3: Agent Credentials -->
            <div class="wizard-step" id="step-3">
                <h3>Agent Credentials</h3>
                <p class="info">Provide the API credentials that your agent will use to authenticate.</p>
                <div class="form-group">
                    <label for="agent-api-key">Agent API Key *</label>
                    <input type="text" id="agent-api-key" name="agent_api_key" required 
                           placeholder="Your agent's API key">
                </div>
                <div class="form-group">
                    <label for="agent-api-secret">Agent API Secret *</label>
                    <input type="password" id="agent-api-secret" name="agent_api_secret" required 
                           placeholder="Your agent's API secret">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="prevStep()">Back</button>
                    <button type="button" class="btn btn-primary" onclick="nextStep()">Next: Review</button>
                </div>
            </div>
            
            <!-- Step 4: Review & Submit -->
            <div class="wizard-step" id="step-4">
                <h3>Review & Connect</h3>
                <div class="review-section">
                    <h4>Agent Information</h4>
                    <div id="review-agent-info"></div>
                    
                    <h4>Database Connection</h4>
                    <div id="review-database-info"></div>
                    
                    <h4>Credentials</h4>
                    <div id="review-credentials-info"></div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="prevStep()">Back</button>
                    <button type="submit" class="btn btn-success">Connect Agent</button>
                </div>
            </div>
        </form>
        
        <div id="success-message" class="success-message" style="display: none;">
            <h3>✓ Agent Connected Successfully!</h3>
            <div id="success-details"></div>
            <a href="/agents" class="btn btn-primary">View Agents</a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/wizard.js') }}"></script>
{% endblock %}

